name: ğŸš€ FTP Deploy to Production

# Ne zaman Ã§alÄ±ÅŸacak?
on:
  push:
    branches: [ main ]  # main branch'e push yapÄ±ldÄ±ÄŸÄ±nda otomatik deploy
  workflow_dispatch:   # Manuel tetikleme (GitHub Actions sekmesinden)

jobs:
  deploy:
    name: ğŸ“¦ Deploy to FTP Server
    runs-on: ubuntu-latest

    steps:
    # 1. Kodu GitHub'dan al
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3
      with:
        fetch-depth: 2  # Son 2 commit'i al (deÄŸiÅŸiklikleri gÃ¶rmek iÃ§in)

    # 2. DeÄŸiÅŸen dosyalarÄ± gÃ¶ster (log iÃ§in)
    - name: ğŸ“‹ Show Changed Files
      run: |
        echo "ğŸ” DeÄŸiÅŸen dosyalar:"
        git diff --name-only HEAD^ HEAD || echo "Ä°lk commit veya tek dosya"

    # 3. FTP ile sunucuya yÃ¼kle
    - name: ğŸš€ FTP Deploy
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}

        # Hedef klasÃ¶r (sunucudaki)
        server-dir: /public_html/

        # YÃ¼klenecek dosyalar (varsayÄ±lan: tÃ¼m dosyalar)
        # EÄŸer sadece belirli bir klasÃ¶r yÃ¼klemek isterseniz:
        # local-dir: ./  # Yerel klasÃ¶r (repository root)

        # YÃ¼klenmeyecek dosyalar/klasÃ¶rler
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/vendor/**
          **/.env.local
          **/.DS_Store
          **/Thumbs.db
          .github/**
          .gitignore
          README.md
          LICENSE
          composer.json
          composer.lock
          package.json
          package-lock.json
          .editorconfig

        # Log seviyeleri: minimal, standard, verbose
        log-level: standard

        # GÃ¼venlik: Sunucudaki ekstra dosyalarÄ± silme (dikkatli kullanÄ±n!)
        # dangerous-clean-slate: false  # true yapmayÄ±n, manuel yÃ¼klenen dosyalar silinir!

    # 4. Deployment sonrasÄ± bilgilendirme
    - name: âœ… Deployment Complete
      if: success()
      run: |
        echo "ğŸ‰ Deployment baÅŸarÄ±lÄ±!"
        echo "ğŸ“… Tarih: $(date)"
        echo "ğŸ”— Site: https://yourdomain.com"

    # 5. Hata durumunda bilgilendirme
    - name: âŒ Deployment Failed
      if: failure()
      run: |
        echo "ğŸ’¥ Deployment baÅŸarÄ±sÄ±z!"
        echo "ğŸ“‹ LÃ¼tfen loglarÄ± kontrol edin"
